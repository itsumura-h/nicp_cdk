---
description: 55-estimate-cycleãƒ–ãƒ©ãƒ³ãƒã§ã®é–‹ç™ºæ™‚ã«èª­ã¿è¾¼ã‚€
alwaysApply: false
---
55-estimate-cycle ãƒ–ãƒ©ãƒ³ãƒãƒ«ãƒ¼ãƒ«
===

ã“ã®ãƒ–ãƒ©ãƒ³ãƒã§å®Ÿè£…ã™ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
- ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚­ãƒ£ãƒ‹ã‚¹ã‚¿ãƒ¼ã‚’å‘¼ã³å‡ºã™æ™‚ã«ã€cycleé‡ã‚’è¨ˆç®—ã—ã€å¿…è¦ãªã ã‘è£œå……ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹
- å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:
  - `src/nicp_cdk/canisters/management_canister/http_outcall.nim`
  - `src/nicp_cdk/canisters/management_canister/t_ecdsa.nim`

## ãƒ‡ãƒãƒƒã‚°ç”¨å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
```bash
# t_ecdsaã®ä¾‹ã‚’ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ãƒ†ã‚¹ãƒˆ
cd /application
make deploy-local-t_ecdsa
dfx canister call t_ecdsa_backend public_key '()'
dfx canister call t_ecdsa_backend sign '(record { message_hash = blob "\00\01\02\03\04\05\06\07\08\09\0a\0b\0c\0d\0e\0f\10\11\12\13\14\15\16\17\18\19\1a\1b\1c\1d\1e\1f" })'
```

## é€²æ—
- [x] `http_outcall.nim`ã®èª¿æŸ»
  - [x] ç¾åœ¨ã®cycleè£œå……å‡¦ç†ã‚’ç¢ºèª
  - [x] `estimateHttpOutcallCost`é–¢æ•°ã®å‹•ä½œã‚’ç¢ºèª
  - [x] `ic0_cost_http_request`ã®ä½¿ç”¨æ–¹æ³•ã‚’ç¢ºèª
- [x] `t_ecdsa.nim`ã®èª¿æŸ»
  - [x] ç¾åœ¨ã®cycleè£œå……å‡¦ç†ã‚’ç¢ºèªï¼ˆå®šæ•°`EcdsaCallCycles`ã‚’ä½¿ç”¨ï¼‰
  - [x] `ic0_cost_sign_with_ecdsa`ãŒä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆ`ic0.nim`ã«å®£è¨€ã‚ã‚Šï¼‰
- [x] cycleè¨ˆç®—å‡¦ç†ã®å®Ÿè£…
  - [x] `http_outcall.nim`ã®`httpRequest`é–¢æ•°ã§cycleè¨ˆç®—ã‚’å®Ÿè£…
  - [x] `t_ecdsa.nim`ã®`publicKey`é–¢æ•°ã§cycleè¨ˆç®—ã‚’å®Ÿè£…
  - [x] `t_ecdsa.nim`ã®`sign`é–¢æ•°ã§cycleè¨ˆç®—ã‚’å®Ÿè£…
- [x] ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°
  - [x] ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã§ãƒ†ã‚¹ãƒˆ
  - [x] cycleé‡ãŒé©åˆ‡ã‹ç¢ºèªï¼ˆ`signWithEthereum`ãŒæ­£å¸¸ã«å‹•ä½œï¼‰
  - [x] `ic0_cost_sign_with_ecdsa`ã®å•é¡Œã‚’ç‰¹å®šã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ã«åˆ‡ã‚Šæ›¿ãˆ
  - [x] ã‚¨ãƒ©ãƒ¼ãªãç½²åãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

## å‚è€ƒè³‡æ–™
- IC System API: https://internetcomputer.org/docs/current/references/ic-interface-spec/#system-api-imports
- `ic0_cost_http_request`: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ­£ç¢ºãªcycleé‡ã‚’è¨ˆç®—
- `ic0_cost_sign_with_ecdsa`: ECDSAç½²åã®æ­£ç¢ºãªcycleé‡ã‚’è¨ˆç®—
- Internet Computeré–‹ç™ºè€…ãƒ•ã‚©ãƒ¼ãƒ©ãƒ : https://forum.dfinity.org
- ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰:
  - `http_outcall.nim`: `estimateHttpOutcallCost`é–¢æ•°ãŒå­˜åœ¨ã™ã‚‹ãŒã€å®Ÿéš›ã«ã¯ä½¿ã‚ã‚Œã¦ã„ãªã„
  - `t_ecdsa.nim`: å®šæ•°`EcdsaCallCycles = 26_153_846_153'u64`ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ã¦ä½¿ç”¨

### `ic0_cost_sign_with_ecdsa`ã®æ­£ã—ã„ä½¿ç”¨æ–¹æ³•ï¼ˆWebæ¤œç´¢çµæœã‚ˆã‚Šï¼‰

#### é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ï¼ˆic0.nimï¼‰
```nim
proc ic0_cost_sign_with_ecdsa*(src: int, size: int, ecdsa_curve: uint32, dst: int): uint32
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- `src`: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆCandidã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ï¼‰
- `size`: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒˆã‚µã‚¤ã‚º
- `ecdsa_curve`: æ›²ç·šã‚¿ã‚¤ãƒ—ï¼ˆsecp256k1 = 0, secp256r1 = 1ï¼‰
- `dst`: çµæœï¼ˆ128bit cyclesï¼‰ã‚’æ ¼ç´ã™ã‚‹ãƒãƒƒãƒ•ã‚¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
- **æˆ»ã‚Šå€¤**: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆ0 = æˆåŠŸã€é0 = ã‚¨ãƒ©ãƒ¼ï¼‰

#### ä½¿ç”¨æ‰‹é †
1. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®æº–å‚™ï¼ˆCandidã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ï¼‰
2. `ic0_cost_sign_with_ecdsa`ã‚’å‘¼ã³å‡ºã—ã¦cycleé‡ã‚’è¨ˆç®—
3. è¿”ã•ã‚ŒãŸcycleæ•°ã‚’`ic0_call_cycles_add128`ã§è¿½åŠ 
4. `sign_with_ecdsa`ã‚’å®Ÿè¡Œ

#### Nimå®Ÿè£…ä¾‹
```nim
proc estimateEcdsaCost(keyId: EcdsaKeyId, payload: seq[uint8]): uint64 =
  try:
    let curveValue = uint32(keyId.curve.ord)
    var costBuffer: array[16, uint8]  # 128bit for cycles
    
    let apiResult = ic0_cost_sign_with_ecdsa(
      ptrToInt(addr payload[0]),       # ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å…ˆé ­ã‚¢ãƒ‰ãƒ¬ã‚¹
      payload.len,                     # ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚º
      curveValue,                      # ECDSAæ›²ç·šã‚¿ã‚¤ãƒ—
      ptrToInt(addr costBuffer[0])     # çµæœã‚’æ ¼ç´ã™ã‚‹ãƒãƒƒãƒ•ã‚¡
    )
    
    if apiResult != 0:
      return EcdsaCallCyclesFallback   # ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    
    # 128bitå€¤ã‚’64bitã«å¤‰æ›
    var exactCost: uint64 = 0
    for i in 0..<8:
      exactCost = exactCost or (uint64(costBuffer[i]) shl (i * 8))
    
    return exactCost + (exactCost div 5)  # +20%ãƒãƒ¼ã‚¸ãƒ³
  except Exception:
    return EcdsaCallCyclesFallback
```

#### é‡è¦ãªæ³¨æ„ç‚¹
- ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯**Candidã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿**ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- APIã¯ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†…å®¹ã‚’è§£æã—ã¦ã‚³ã‚¹ãƒˆã‚’è¨ˆç®—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- å®Ÿéš›ã®cycleé‡ã¯`dst`ãƒãƒƒãƒ•ã‚¡ã«128bitå€¤ã¨ã—ã¦æ ¼ç´ã•ã‚Œã‚‹
- æˆ»ã‚Šå€¤ã¯ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Šã€cycleé‡ã§ã¯ãªã„

## èª¿æŸ»çµæœãƒ»è¨­è¨ˆã¾ã¨ã‚

### å®Ÿè£…å®Œäº†ã—ãŸå†…å®¹

1. **http_outcall.nim**:
   - **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ•ãƒ©ã‚°åˆ¶å¾¡ã‚’å®Ÿè£…**:
     - `estimateHttpOutcallCostDynamic()` - `ic0_cost_http_request`ã§å‹•çš„è¨ˆç®—
     - `estimateHttpOutcallCost()` - ãƒ•ãƒ©ã‚°ã«å¿œã˜ã¦æœ€é©ãªæ–¹æ³•ã‚’é¸æŠ
   - **ç’°å¢ƒé©å¿œå‹ã®å®Ÿè£…**:
     - `-d:release`ãƒ•ãƒ©ã‚°ä»˜ã: `ic0_cost_http_request`ã§å‹•çš„è¨ˆç®—ã‚’è©¦è¡Œ
     - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ï¼ˆ50,000,000,000 cyclesï¼‰ã‚’ä½¿ç”¨
   - `ic0_call_cycles_add128`ã‚’ä½¿ã£ã¦è¨ˆç®—ã—ãŸcycleé‡ã‚’è¿½åŠ 
   - 20%ã®å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦cycleã‚’è¨ˆç®—
   
2. **t_ecdsa.nim**:
   - **3ã¤ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ **:
     - `isReplicatedExecution(): bool` - å®Ÿè¡Œç’°å¢ƒã‚’åˆ¤å®šï¼ˆãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒã‹ãƒ­ãƒ¼ã‚«ãƒ«ã‹ï¼‰
     - `estimateEcdsaCostDynamic(keyId, payload): uint64` - `ic0_cost_sign_with_ecdsa`ã§å‹•çš„è¨ˆç®—
     - `estimateEcdsaCost(keyId, payload): uint64` - ç’°å¢ƒã«å¿œã˜ã¦æœ€é©ãªæ–¹æ³•ã‚’é¸æŠ
   - **ç’°å¢ƒé©å¿œå‹ã®å®Ÿè£…**:
     - `ic0_in_replicated_execution()`ã§ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒã‚’æ¤œå‡º
     - ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒã§ã¯`ic0_cost_sign_with_ecdsa`ã§å‹•çš„è¨ˆç®—ã‚’è©¦è¡Œ
     - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã§ã¯æœ€åˆã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨
   - **å …ç‰¢ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
     - APIã‚¨ãƒ©ãƒ¼ï¼ˆæˆ»ã‚Šå€¤éã‚¼ãƒ­ï¼‰ã€è¨ˆç®—çµæœãŒ0ã€ä¾‹å¤–ç™ºç”Ÿæ™‚ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
     - ã©ã®çŠ¶æ³ã§ã‚‚ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹3å±¤ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹
   - å›ºå®šå€¤`EcdsaCallCycles`ã‚’`EcdsaCallCyclesFallback`ã«åç§°å¤‰æ›´ã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã¨ã—ã¦ä¿æŒ
   - `publicKey`é–¢æ•°ã¨`sign`é–¢æ•°ã§å…±é€šã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦cycleã‚’è¿½åŠ 
   - å¼•æ•°ã‹ã‚‰å®Ÿéš›ã«ä½¿ç”¨ã™ã‚‹ã®ã¯`key_id`ã®ã¿ãªã®ã§ã€é–¢æ•°ã‚’å…±é€šåŒ–ã—ã¦ã‚³ãƒ¼ãƒ‰é‡è¤‡ã‚’å‰Šæ¸›
   - 20%ã®å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦cycleã‚’è¨ˆç®—
   
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**:
   - cycleè¨ˆç®—APIãŒå¤±æ•—ã—ãŸå ´åˆï¼ˆéã‚¼ãƒ­ã‚’è¿”ã—ãŸå ´åˆï¼‰ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè£…
   - ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸå ´åˆã‚‚åŒæ§˜ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨
   - ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ 

### æŠ€è¡“çš„ãªæ³¨æ„ç‚¹ã¨ä»Šå¾Œã®æ”¹å–„

#### âœ… ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ•ãƒ©ã‚°åˆ¶å¾¡å®Ÿè£…ï¼ˆæœ€çµ‚ç‰ˆï¼‰

**å…±é€šè¨­è¨ˆ**:
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ•ãƒ©ã‚°ã§å‹•çš„è¨ˆç®—ã‚’åˆ¶å¾¡**: `-d:release`
  - **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆé–‹ç™ºæ™‚ï¼‰**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«å¯¾å¿œï¼‰
  - **`-d:release`ãƒ•ãƒ©ã‚°ä»˜ãï¼ˆæœ¬ç•ªï¼‰**: å‹•çš„è¨ˆç®—ã‚’è©¦è¡Œ
- **å®‰å…¨æ€§å„ªå…ˆã®è¨­è¨ˆ**:
  - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã§ã¯ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä½¿ç”¨
  - æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯`-d:release`ã§å‹•çš„è¨ˆç®—ã‚’è‡ªå‹•æœ‰åŠ¹åŒ–

**http_outcall.nim**:
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤: 50,000,000,000 cyclesï¼ˆ50 billionï¼‰
- `-d:release`æ™‚: `ic0_cost_http_request`ã§å‹•çš„è¨ˆç®—
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯å³åº§ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã‚’ä½¿ç”¨

**t_ecdsa.nim**:
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤: 26,153,846,153 cycles
- `-d:release`æ™‚: ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒåˆ¤å®šå¾Œã€`ic0_cost_sign_with_ecdsa`ã§å‹•çš„è¨ˆç®—
- **3å±¤ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹**ï¼ˆå‹•çš„è¨ˆç®—æœ‰åŠ¹æ™‚ï¼‰:
  1. ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒåˆ¤å®šï¼ˆ`ic0_in_replicated_execution()`ï¼‰
  2. `ic0_cost_sign_with_ecdsa`ã§å‹•çš„è¨ˆç®—
  3. APIã‚¨ãƒ©ãƒ¼æ™‚ï¼ˆæˆ»ã‚Šå€¤éã‚¼ãƒ­ã€çµæœãŒ0ã€ä¾‹å¤–ç™ºç”Ÿï¼‰ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤

#### `ic0_cost_sign_with_ecdsa`ã®æ­£ã—ã„ä½¿ç”¨æ–¹æ³•ï¼ˆå‚è€ƒï¼‰
Webæ¤œç´¢ã§åˆ¤æ˜ã—ãŸæ­£ã—ã„ä½¿ç”¨æ–¹æ³•ï¼š
1. Candidã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å…ˆé ­ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã‚µã‚¤ã‚ºã‚’æ¸¡ã™
2. æ›²ç·šã‚¿ã‚¤ãƒ—ï¼ˆsecp256k1 = 0, secp256r1 = 1ï¼‰ã‚’æŒ‡å®š
3. 128bit cycleãƒãƒƒãƒ•ã‚¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¸¡ã™
4. æˆ»ã‚Šå€¤ï¼ˆã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰ãŒ0ãªã‚‰æˆåŠŸã€é0ãªã‚‰ã‚¨ãƒ©ãƒ¼
5. æˆåŠŸæ™‚ã¯å–å¾—ã—ãŸcycleé‡ã«20%ã®å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ 

#### å®Ÿè£…ã®åˆ©ç‚¹
- **ç’°å¢ƒé©å¿œæ€§**: å®Ÿè¡Œç’°å¢ƒã‚’è‡ªå‹•åˆ¤å®šã—ã€æœ€é©ãªæ–¹æ³•ã§cycleé‡ã‚’è¨ˆç®—
- **æŸ”è»Ÿæ€§**: ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒã§ã¯APIã«ã‚ˆã‚‹å‹•çš„è¨ˆç®—ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯å®‰å®šã—ãŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤
- **å®‰å…¨æ€§**: 3å±¤ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿæ§‹ã«ã‚ˆã‚Šã€ã‚ã‚‰ã‚†ã‚‹çŠ¶æ³ã§å‹•ä½œã‚’ä¿è¨¼
- **ä¿å®ˆæ€§**: è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã§å‹•ä½œçŠ¶æ³ã‚’ç¢ºèªå¯èƒ½
- **å°†æ¥æ€§**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã®å®Ÿè£…ãŒæ”¹å–„ã•ã‚Œã‚Œã°ã€è‡ªå‹•çš„ã«å‹•çš„è¨ˆç®—ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
- **æœ¬ç•ªå¯¾å¿œ**: ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆ/ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã§ã¯æ­£ç¢ºãªcycleè¨ˆç®—ãŒå¯èƒ½

#### ãã®ä»–ã®æ³¨æ„ç‚¹
- Nimã®ç‰¹æ®Šå¤‰æ•°`result`ã¨ã®ã‚·ãƒ£ãƒ‰ãƒ¼ã‚¤ãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã€å¤‰æ•°åã«æ³¨æ„
- cycleè¨ˆç®—ã¯å¸¸ã«ä½™è£•ã‚’æŒãŸã›ã‚‹ï¼ˆ20%ãƒãƒ¼ã‚¸ãƒ³æ¨å¥¨ï¼‰
- ãƒ­ã‚°å‡ºåŠ›ã§å®Ÿéš›ã«ä½¿ç”¨ã•ã‚ŒãŸcycleé‡ã‚’ç¢ºèªå¯èƒ½

### ãƒ†ã‚¹ãƒˆæ–¹æ³•

#### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã§ã®ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
```bash
cd /application/examples/t_ecdsa
make backend && make call
```

#### ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆ/ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã§ã®ãƒ†ã‚¹ãƒˆï¼ˆå‹•çš„è¨ˆç®—æœ‰åŠ¹åŒ–ï¼‰
`-d:release`ãƒ•ãƒ©ã‚°ã§è‡ªå‹•çš„ã«å‹•çš„è¨ˆç®—ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™:
```bash
# ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ï¼ˆå‹•çš„è¨ˆç®—ãŒæœ‰åŠ¹ï¼‰
nim c -d:release -o:wasi.wasm src/t_ecdsa_backend/main.nim

# ãƒ‡ãƒ—ãƒ­ã‚¤
dfx deploy t_ecdsa_backend --network ic
```

æ³¨: `-d:release`ã¯æœ€é©åŒ–ãƒ•ãƒ©ã‚°ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã€æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã§ã¯å¸¸ã«æ¨å¥¨ã•ã‚Œã¾ã™ã€‚

ãƒ­ã‚°å‡ºåŠ›ã§ä»¥ä¸‹ã‚’ç¢ºèª:
- **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«**: `ğŸ“Š Estimated ECDSA cost (fallback): 26153846153 cycles`
- **ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒ**: `ğŸ“Š Estimated ECDSA cost (dynamic): [è¨ˆç®—å€¤] cycles + 20% margin = [æœ€çµ‚å€¤] cycles`
- `Adding cycles for ECDSA public_key:` / `Adding cycles for ECDSA sign:` - è¿½åŠ ã•ã‚Œã‚‹cycleé‡

### ç’°å¢ƒé©å¿œå‹å®Ÿè£…ã®å‹•ä½œç¢ºèª

#### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒ—ãƒªã‚«ã§ã®ãƒ­ã‚°ä¾‹
```
ğŸ“Š Estimated ECDSA cost (fallback): 26153846153 cycles (payload size: 141 bytes)
Adding cycles for ECDSA public_key: 26153846153
```

#### ãƒ¬ãƒ—ãƒªã‚«ç’°å¢ƒï¼ˆãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆ/ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆï¼‰ã§ã®æœŸå¾…ãƒ­ã‚°
```
ğŸ“Š Estimated ECDSA cost (dynamic): [APIè¨ˆç®—å€¤] cycles + 20% margin = [æœ€çµ‚å€¤] cycles
Adding cycles for ECDSA public_key: [æœ€çµ‚å€¤]
```

ã¾ãŸã¯ã€APIã‚¨ãƒ©ãƒ¼æ™‚:
```
âš ï¸ ic0_cost_sign_with_ecdsa returned error code: [ã‚³ãƒ¼ãƒ‰], using fallback
ğŸ“Š Estimated ECDSA cost (fallback): 26153846153 cycles (payload size: [ã‚µã‚¤ã‚º] bytes)
```
