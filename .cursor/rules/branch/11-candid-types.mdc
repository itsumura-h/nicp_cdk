---
description: 
globs: 
alwaysApply: true
---
ã“ã®ãƒ–ãƒ©ãƒ³ãƒã§ã¯ã€nicp_cdkãŒcandidã®å…¨ã¦ã®å‹ã«ã¤ã„ã¦Nimã®å‹ã¨ã®ç›¸äº’å¤‰æ›ã¨candid messageã¨ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãè¡Œã‚ã‚Œã‚‹å‡¦ç†ã‚’ä½œã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

ãƒ†ã‚¹ãƒˆã¯å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆã¨ã€å®Ÿéš›ã«canisterã‚’å‹•ã‹ã—ã¦ã®2ã¤ã®æ–¹æ³•ã§è¡Œã†ã€‚

## å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆ
- /application/tests/types ä»¥ä¸‹ã«ã€ãã‚Œãã‚Œã®candidå‹ã«ã¤ã„ã¦ã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚
  - serializeCandidé–¢æ•°ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹
  - candidã®å‹ã‚’Nimã®å‹ã«å¤‰æ›ã—ã¦ã€ãã‚Œã‚’candid messageã¨ã—ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã€Nimã®å‹ã«å¤‰æ›ã™ã‚‹ã¨ã„ã†æµã‚Œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚
- canisterã‚’å‹•ã‹ã—ã¦ã®ãƒ†ã‚¹ãƒˆ
  - `/application/examples/arg_msg_reply/src/arg_msg_reply_backend/main.nim` ã«ã€ãã‚Œãã‚Œã®å‹ã®å¼•æ•°ã‚’å—ã‘å–ã£ã¦ã€ãã‚Œã‚’ã¾ãŸè¿”ã™ã‚ˆã†ãªé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚
  - é–¢æ•°åã¯ã€ãã®å‹ã®å¼•æ•°ã‚’å—ã‘å–ã‚‹å ´åˆã¯ `arg{å‹å}` ã¨ã€å¼•æ•°ã‚’å—ã‘å–ã‚‰ãšã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã ã‘ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã„å ´åˆã¯ `response{å‹å}`ã¨ã™ã‚‹ã“ã¨
  - `/application/examples/arg_msg_reply` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã€ `dfx deploy -y` ã‚’å®Ÿè¡Œã—ã€ `dfx canister call arg_msg_reply arg{å‹å}` ã‚’å®Ÿè¡Œã—ã¦ã€ãã‚Œãã‚Œã®å‹ã®å¼•æ•°ã‚’å—ã‘å–ã£ã¦ã€ãã‚Œã‚’ã¾ãŸè¿”ã™ã‚ˆã†ãªé–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦æˆåŠŸã—ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä¸€è¦§ã«é€²æ—ã‚’è¨˜å…¥ã™ã‚‹ã“ã¨ã€‚

## ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä¸€è¦§

### åŸºæœ¬å‹ï¼ˆPrimitive Typesï¼‰
- [x] **ctNull** - nullå€¤ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_null.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNull`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctBool** - booleanå€¤ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_bool.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argBool`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctNat** - è‡ªç„¶æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_nat.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNat`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctInt** - æ•´æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_int.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argInt`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctNat8** - 8bitè‡ªç„¶æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_nat8.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNat8`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctNat16** - 16bitè‡ªç„¶æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_nat16.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNat16`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctNat32** - 32bitè‡ªç„¶æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_nat32.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNat32`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctNat64** - 64bitè‡ªç„¶æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_nat64.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argNat64`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆå°ã•ãªå€¤ã¯å‹•ä½œã€å¤§ããªå€¤ã¯åˆ¶ç´„ã‚ã‚Šï¼‰

- [x] **ctInt8** - 8bitæ•´æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_int8.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argInt8`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctInt16** - 16bitæ•´æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_int16.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argInt16`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctInt32** - 32bitæ•´æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_int32.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argInt32`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: Subtyping error Int32ï¼‰

- [x] **ctInt64** - 64bitæ•´æ•°ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_int64.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argInt64`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆåŸºæœ¬å€¤ã¯å‹•ä½œã€å¤§ããªå€¤ã§Canisterã‚¨ãƒ©ãƒ¼IC0506ï¼‰

- [x] **ctFloat32** - 32bitæµ®å‹•å°æ•°ç‚¹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_float32.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argFloat32`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctFloat64** - 64bitæµ®å‹•å°æ•°ç‚¹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_float64.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argFloat64`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctText** - ãƒ†ã‚­ã‚¹ãƒˆå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_text.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argText`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã§å®Ÿè£…ç¢ºèªæ¸ˆã¿ï¼‰

- [x] **ctPrincipal** - Principalå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_principal.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argPrincipal`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

### è¤‡åˆå‹ï¼ˆComposite Typesï¼‰
- [x] **ctBlob** - ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿å‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_blob.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argBlob`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctOpt** - Optionå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_opt.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argOpt`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆSome/Noneã®ä¸¡æ–¹ï¼‰

- [x] **ctVec** - Vector/Arrayå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_vec.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argVec`, `responseVec`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆnat16ãƒ™ã‚¯ã‚¿ãƒ¼ã§å®Ÿè£…å®Œäº†ï¼‰

- [x] **ctRecord** - Recordå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_record.nim`)
  - [x] éå¯¾å¿œå‹åˆ¶é™æ©Ÿèƒ½å®Ÿè£… (func, service, reserved, query, oneway, composite_query)
  - [x] ä»£æ›¿å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ (Principal + Textçµ„ã¿åˆã‚ã›)
  - [x] ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã§ã®åˆ¶é™ãƒ†ã‚¹ãƒˆ
  - [x] canisteré–¢æ•°ä½œæˆ (`responseRecord`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctVariant** - Variantå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_variant.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argVariant`, `responseVariant`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã§å®Ÿè£…ç¢ºèªæ¸ˆã¿ï¼‰

### ç‰¹æ®Šå‹ï¼ˆSpecial Typesï¼‰
- [x] **ctFunc** - Functionå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_func.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`argFunc`, `responseFunc`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ã§æŠ€è¡“çš„åˆ¶ç´„ã‚ã‚Šï¼‰

- [ ] **ctService** - Serviceå‹ã®ãƒ†ã‚¹ãƒˆ
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_service.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argService`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

- [ ] **ctReserved** - Reservedå‹ã®ãƒ†ã‚¹ãƒˆ
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_reserved.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argReserved`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

- [x] **ctEmpty** - Emptyå‹ã®ãƒ†ã‚¹ãƒˆ
  - [x] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_empty.nim`)
  - [x] canisteré–¢æ•°ä½œæˆ (`responseEmpty`)
  - [x] dfx call ãƒ†ã‚¹ãƒˆï¼ˆresponseEmptyæ­£å¸¸å‹•ä½œç¢ºèªæ¸ˆã¿ï¼‰

### ä¿®é£¾å‹ï¼ˆQualifier Typesï¼‰
- [ ] **ctQuery** - Queryå‹ã®ãƒ†ã‚¹ãƒˆ
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_query.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argQuery`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

- [ ] **ctOneway** - Onewayå‹ã®ãƒ†ã‚¹ãƒˆ
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_oneway.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argOneway`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

- [ ] **ctCompositeQuery** - CompositeQueryå‹ã®ãƒ†ã‚¹ãƒˆ
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_composite_query.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argCompositeQuery`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ

### ç‰¹åˆ¥ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆManagement Canisterç”¨ï¼‰
- [ ] **EcdsaPublicKeyArgs** - Management Canisterã®ECDSA Public Keyç”¨ã®è¤‡åˆå‹
  - [ ] å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (`tests/types/test_ecdsa_public_key_args.nim`)
  - [ ] canisteré–¢æ•°ä½œæˆ (`argEcdsaPublicKeyArgs`)
  - [ ] dfx call ãƒ†ã‚¹ãƒˆ
  - [ ] å®Ÿéš›ã®Management Canisterå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ

### è¤‡åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
- [ ] **ãƒã‚¹ãƒˆã—ãŸRecord** - Recordå†…ã«RecordãŒå«ã¾ã‚Œã‚‹å ´åˆ
- [ ] **ãƒã‚¹ãƒˆã—ãŸVariant** - Variantå†…ã«VariantãŒå«ã¾ã‚Œã‚‹å ´åˆ
- [ ] **è¤‡é›‘ãªOpt** - Optionå†…ã«è¤‡åˆå‹ãŒå«ã¾ã‚Œã‚‹å ´åˆ
- [ ] **æ··åœ¨Vec** - ç•°ãªã‚‹å‹ãŒæ··åœ¨ã™ã‚‹Vector
- [ ] **å¤§ããªãƒ‡ãƒ¼ã‚¿** - ã‚µã‚¤ã‚ºãŒå¤§ããªBlob/Textã®ãƒ†ã‚¹ãƒˆ

## Recordå‹ã«ãŠã‘ã‚‹éå¯¾å¿œå‹ã®åˆ¶é™è¨­è¨ˆæ–¹é‡

### èƒŒæ™¯ã¨ç›®çš„
ICPã®Canisterç’°å¢ƒã«ãŠã„ã¦ã€ä¸€éƒ¨ã®Candidå‹ã¯Canisteré–“é€šä¿¡ã§ç›´æ¥ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯å®Ÿç”¨æ€§ã«åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚Recordå‹å†…ã«ã“ã‚Œã‚‰ã®å‹ãŒå«ã¾ã‚Œã‚‹ã¨ã€Canisterã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ãŸã‚ã€äº‹å‰ã«æ¤œè¨¼ã¨ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’è¡Œã†è¨­è¨ˆã¨ã—ã¾ã™ã€‚

### åˆ¶é™å¯¾è±¡ã®å‹
ä»¥ä¸‹ã®Candidå‹ã¯Recordå‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã›ã‚“ï¼š

1. **ctFunc** - Functionå‹
   - Canisteré–“é–¢æ•°å‚ç…§ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ãŒã€ç¾åœ¨ã®ICPå®Ÿè£…ã§ã¯åˆ¶é™ãŒã‚ã‚‹
   - Opaque referenceã¨ã—ã¦ã®å®Œå…¨ãªå®Ÿè£…ãŒå›°é›£

2. **ctService** - Serviceå‹  
   - Canisterã‚µãƒ¼ãƒ“ã‚¹å‚ç…§ã ãŒã€Recordå†…ã§ã®ä½¿ç”¨ã¯å®Ÿç”¨æ€§ãŒä½ã„
   - Principalå‹ã§ã®ä»£æ›¿ãŒæ¨å¥¨ã•ã‚Œã‚‹

3. **ctReserved** - Reservedå‹
   - å°†æ¥ã®æ‹¡å¼µç”¨ã«äºˆç´„ã•ã‚ŒãŸå‹ã§ã€ç¾åœ¨ã¯ä½¿ç”¨ä¸å¯

4. **ctQuery** - Queryä¿®é£¾å‹
   - é–¢æ•°ã®ä¿®é£¾å­ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦å˜ç‹¬ä½¿ç”¨ã¯ä¸é©åˆ‡

5. **ctOneway** - Onewayä¿®é£¾å‹
   - é–¢æ•°ã®ä¿®é£¾å­ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦å˜ç‹¬ä½¿ç”¨ã¯ä¸é©åˆ‡

6. **ctCompositeQuery** - CompositeQueryä¿®é£¾å‹
   - é–¢æ•°ã®ä¿®é£¾å­ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦å˜ç‹¬ä½¿ç”¨ã¯ä¸é©åˆ‡

### å®Ÿè£…æ–¹é‡

#### ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **Recordä½œæˆæ™‚**: `newCRecord()`, `%*ãƒã‚¯ãƒ­`, `CandidRecord`ã®å„ç¨®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šæ™‚**: `record[key] = value`ã®ä»£å…¥æ“ä½œ
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚**: `record.add(key, value)`ãªã©ã®è¿½åŠ æ“ä½œ

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆ
```nim
ValueError: Unsupported Candid type '{type_name}' in Record field '{field_name}'. 
This type is not supported in ICP Canister communication.
Supported alternatives: Principal (for service references), Text (for function names)
```

#### ä»£æ›¿æ¡ˆã®ææ¡ˆ
åˆ¶é™ã•ã‚ŒãŸå‹ã®ä»£æ›¿æ¡ˆã‚’æ˜ç¤ºçš„ã«ææ¡ˆï¼š
- **func/service â†’ Principal + methodå**: é–¢æ•°/ã‚µãƒ¼ãƒ“ã‚¹å‚ç…§ã¯`Principal`ã¨`Text`ã®çµ„ã¿åˆã‚ã›ã§è¡¨ç¾
- **reserved â†’ ã‚¨ãƒ©ãƒ¼**: ä½¿ç”¨ä¸å¯ã€è¨­è¨ˆè¦‹ç›´ã—ãŒå¿…è¦  
- **ä¿®é£¾å‹ â†’ ã‚¨ãƒ©ãƒ¼**: é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã®ä¸€éƒ¨ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿å‹ã¨ã—ã¦ä¸é©åˆ‡

#### å®Ÿè£…ç®‡æ‰€
1. **ic_record.nim**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®è¿½åŠ 
2. **candid_funcs.nim**: å‹ãƒã‚§ãƒƒã‚¯é–¢æ•°ã®è¿½åŠ   
3. **test_record.nim**: ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
```nim
proc validateRecordFieldType(cv: CandidValue, fieldName: string) =
  ## Recordå†…ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¯¾å¿œã—ã¦ã„ã‚‹å‹ã‹ãƒã‚§ãƒƒã‚¯
  case cv.kind:
  of ctFunc, ctService, ctReserved, ctQuery, ctOneway, ctCompositeQuery:
    let typeName = case cv.kind:
      of ctFunc: "func"
      of ctService: "service"  
      of ctReserved: "reserved"
      of ctQuery: "query"
      of ctOneway: "oneway"
      of ctCompositeQuery: "composite_query"
      else: "unknown"
    raise newException(ValueError, 
      &"Unsupported Candid type '{typeName}' in Record field '{fieldName}'. " &
      "This type is not supported in ICP Canister communication.")
  else:
    # ãƒã‚¹ãƒˆã—ãŸRecord/Variant/Arrayå†…ã‚‚ãƒã‚§ãƒƒã‚¯
    case cv.kind:
    of ctRecord:
      for key, value in cv.recordFields:
        validateRecordFieldType(value, &"{fieldName}.{key}")
    of ctVec:
      for i, elem in cv.vecElements:
        validateRecordFieldType(elem, &"{fieldName}[{i}]")
    of ctOpt:
      if cv.optVal.isSome():
        validateRecordFieldType(cv.optVal.get(), &"{fieldName}.some")
    else:
      discard  # ãã®ä»–ã®å‹ã¯è¨±å¯
```

### ãƒ†ã‚¹ãƒˆæ–¹é‡

#### æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ
- è¨±å¯ã•ã‚ŒãŸå‹ã®ã¿ã‚’å«ã‚€Recordã®ä½œæˆãƒ»æ“ä½œ
- ãƒã‚¹ãƒˆã—ãŸRecordæ§‹é€ ã§ã®è¨±å¯ã•ã‚ŒãŸå‹ã®ä½¿ç”¨

#### ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ  
- åˆ¶é™ã•ã‚ŒãŸå‹ã‚’å«ã‚€Recordä½œæˆæ™‚ã®ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ç¢ºèª
- ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã§ã®åˆ¶é™ã•ã‚ŒãŸå‹æ¤œå‡ºç¢ºèª

#### ä»£æ›¿æ¡ˆãƒ†ã‚¹ãƒˆ
- funcå‹ã®ä»£ã‚ã‚Šã«Principal + Textçµ„ã¿åˆã‚ã›ã§ã®å®Ÿè£…ç¢ºèª
- serviceå‹ã®ä»£ã‚ã‚Šã«Principalå‹ã§ã®å®Ÿè£…ç¢ºèª

### äº’æ›æ€§ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿
- ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹func/serviceå‹ã‚’Principalå‹ã«ç½®ãæ›ãˆ
- `%*ãƒã‚¯ãƒ­`ä½¿ç”¨æ™‚ã®è‡ªå‹•çš„ãªåˆ¶é™ãƒã‚§ãƒƒã‚¯

#### æ®µéšçš„ç§»è¡Œ
1. **Phase 1**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®å®Ÿè£…ï¼ˆè­¦å‘Šãƒ¢ãƒ¼ãƒ‰ï¼‰
2. **Phase 2**: ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆ  
3. **Phase 3**: ä»£æ›¿å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ–‡æ›¸åŒ–

## çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰ã®å®Ÿè£…æ–¹é‡
- `/application/tests/test_arg_msg_reply.nim` ã‚’ä½œæˆã—ã€canister callãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•åŒ–ã™ã‚‹
- ãƒ†ã‚¹ãƒˆã®æµã‚Œï¼š
  1. `execProcess`ã‚’ä½¿ç”¨ã—ã¦dfx deployã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦canisterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
  2. å„Candidå‹ã«ã¤ã„ã¦`dfx canister call`ã‚’å®Ÿè¡Œã—ã¦canisterã«å•ã„åˆã‚ã›
  3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å†…å®¹ã‚’æ¤œè¨¼ï¼ˆæ­£ã—ã„Candidå‹ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
  4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆdeployã‚„callå¤±æ•—æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- ãƒ†ã‚¹ãƒˆå¯¾è±¡ï¼š
  - å®Ÿè£…æ¸ˆã¿ã®åŸºæœ¬å‹ï¼ˆnull, bool, nat, int, nat8ï¼‰
  - ä»Šå¾Œå®Ÿè£…ã™ã‚‹å…¨ã¦ã®å‹
- ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œæ™‚ã®æ³¨æ„ï¼š
  - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«examples/arg_msg_replyãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
  - dfx deployã¯`-y`ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã—ã¦å¯¾è©±ã‚’å›é¿
  - stdout/stderrã®é©åˆ‡ãªå‡¦ç†ã¨ãƒ­ã‚°å‡ºåŠ›

## é€²æ—ç¢ºèªæ–¹æ³•
- å„ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ: `nim c -r tests/types/test_*.nim`
- çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ: `nim c -r tests/test_arg_msg_reply.nim` 
  - è‡ªå‹•çš„ã«canisterã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€å®Ÿè£…æ¸ˆã¿ã®å‹ã®canister callãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
  - **å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœï¼ˆè¤‡åˆå‹å«ã‚€æ‹¡å¤§ï¼‰**ï¼š
    - âœ… æˆåŠŸï¼ˆåŸºæœ¬å‹ï¼‰ï¼šresponseNull, argBool, argNat, argInt, argNat8, argNat16, argNat32, argNat64, argInt8, argInt16, argFloat32, argFloat64, argText, argPrincipal, argBlob, argOpt, argVec
    - âœ… æˆåŠŸï¼ˆè¤‡åˆå‹ï¼‰ï¼šargVariant, responseVariantï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã§ç¢ºèªæ¸ˆã¿ï¼‰
    - âŒ å¤±æ•—ï¼šargInt32ï¼ˆå…¨ãƒ†ã‚¹ãƒˆï¼šSubtyping error Int32ï¼‰, argInt64ï¼ˆå¤§ããªå€¤ï¼šCanisterã‚¨ãƒ©ãƒ¼IC0506ï¼‰
    - â³ ãƒ†ã‚¹ãƒˆå¾…ã¡ï¼šresponseRecordï¼ˆcanisteré–¢æ•°ã¯å®Ÿè£…æ¸ˆã¿ï¼‰
    - ğŸ”¶ åˆ¶ç´„ã‚ã‚Šï¼šfuncå‹ï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆOKã€dfx callã¯Candidä»•æ§˜åˆ¶ç´„ã«ã‚ˆã‚Šå¤±æ•—ï¼‰
  - åŸºæœ¬å‹ï¼ˆPrimitive Typesï¼‰ã¯æ¦‚ã­å®Ÿè£…å®Œäº†ã€è¤‡åˆå‹ã®å®Ÿè£…ãŒå¤§å¹…ã«é€²å±•
  - Recordå‹ã¨Variantå‹ã®å˜ä½“ãƒ†ã‚¹ãƒˆãƒ»canisteré–¢æ•°å®Ÿè£…å®Œäº†
- canisterå…¨ä½“ãƒ†ã‚¹ãƒˆ: `cd examples/arg_msg_reply && dfx deploy && dfx canister call arg_msg_reply_backend <function_name>`
- Management Canisteræœ€çµ‚ãƒ†ã‚¹ãƒˆ: `dfx canister call arg_msg_reply_backend argEcdsaPublicKeyArgs`

## çµ±åˆãƒ†ã‚¹ãƒˆã®æ©Ÿèƒ½
- `/application/tests/test_arg_msg_reply.nim` ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã‚’è‡ªå‹•åŒ–ï¼š
  1. dfx deploy -yã«ã‚ˆã‚‹canisterã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
  2. å„Candidå‹ã®canister callå®Ÿè¡Œã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
  3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚°å‡ºåŠ›
- æ–°ã—ã„å‹ãŒå®Ÿè£…ã•ã‚ŒãŸéš›ã¯ã€çµ±åˆãƒ†ã‚¹ãƒˆã«ã‚‚å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ä¿®æ­£æ–¹é‡

### æ–°ã—ã„Candidå‹ã‚’è¿½åŠ ã™ã‚‹éš›ã®å¿…é ˆä¿®æ­£ç®‡æ‰€
1. **candid_types.nim**: `newCandidValue`é–¢æ•°ã«ãã®å‹ã®ã‚µãƒãƒ¼ãƒˆã‚’è¿½åŠ 
   - ä¾‹: `elif T is uint16: CandidValue(kind: ctNat16, natVal: uint(value))`
2. **request.nim**: `get{TypeName}`é–¢æ•°ã‚’è¿½åŠ 
   - ä¾‹: `proc getNat16*(self:Request, index:int): uint16`
3. **reply.nim**: `reply({type})`é–¢æ•°ã‚’è¿½åŠ   
   - ä¾‹: `proc reply*(msg: uint16)`
4. **main.nim**: canisteré–¢æ•°`arg{TypeName}`ã‚’å®Ÿè£…
5. **arg_msg_reply.did**: DIDãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢æ•°å®šç¾©ã‚’è¿½åŠ 
6. **test_arg_msg_reply.nim**: çµ±åˆãƒ†ã‚¹ãƒˆã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 

### å˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
- `newCandidValue(å€¤)`ã‚’ä½¿ç”¨ã—ã¦CandidValueã‚’ä½œæˆ
- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã®æ¤œè¨¼ï¼ˆå›ºå®šå¹…å‹ã¯ä¸€å®šã€å¯å¤‰é•·å‹ã¯å€¤ã«ä¾å­˜ï¼‰
- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ã®å¾€å¾©ãƒ†ã‚¹ãƒˆ
- å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆï¼ˆ0, æœ€å¤§å€¤ã€ç‰¹æ®Šå€¤ï¼‰
- è¤‡æ•°å€¤ã®ãƒ†ã‚¹ãƒˆ

### å‹åˆ¥ã®æ³¨æ„ç‚¹
- **å›ºå®šå¹…å‹** (nat8, nat16, nat32, nat64, int8, int16, int32, int64, float32, float64): 
  - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã¯å›ºå®šï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼7ãƒã‚¤ãƒˆ + å‹ã‚µã‚¤ã‚ºï¼‰
  - `natVal`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨ï¼ˆuintã«ã‚­ãƒ£ã‚¹ãƒˆï¼‰
- **å¯å¤‰é•·å‹** (nat, int, text, blob):
  - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã¯å€¤ã«ä¾å­˜
  - LEB128/SLEB128ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- **è¤‡åˆå‹** (record, variant, vec, opt):
  - ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã®ãƒ†ã‚¹ãƒˆãŒå¿…è¦
  - å‹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¤‡é›‘ã«ãªã‚‹

### dfx callã§ã®å‹æ³¨é‡ãƒ‘ã‚¿ãƒ¼ãƒ³
- å¼•æ•°: `'(å€¤ : å‹å)'` ä¾‹: `'(42 : nat16)'`
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: åŸºæœ¬å‹ã¯å‹æ³¨é‡ã‚ã‚Šã€boolã¯å‹æ³¨é‡ãªã—
- å¤§ããªæ•°å€¤ã¯åŒºåˆ‡ã‚Šæ–‡å­—ä»˜ã: `(1_000 : nat16)`, `(65_535 : nat16)`

### å®Ÿè£…æ™‚ã®æŠ€è¡“çš„æ³¨æ„ç‚¹
- **CandidValueã®çµ±ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: å›ºå®šå¹…natå‹ï¼ˆnat8, nat16, nat32, nat64ï¼‰ã¯å…¨ã¦`natVal: uint`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨
- **å‹ã‚­ãƒ£ã‚¹ãƒˆ**: request/replyã§ã¯é©åˆ‡ãªå‹ã‚­ãƒ£ã‚¹ãƒˆï¼ˆ`uint8`, `uint16`ç­‰ï¼‰ãŒå¿…è¦
- **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºè¨ˆç®—**: 
  - DIDL0ãƒ˜ãƒƒãƒ€ãƒ¼: 4ãƒã‚¤ãƒˆ
  - å‹ãƒ†ãƒ¼ãƒ–ãƒ«: åŸºæœ¬å‹ã§3ãƒã‚¤ãƒˆï¼ˆå‹æ•°1 + å‹ID2ãƒã‚¤ãƒˆï¼‰
  - å€¤éƒ¨åˆ†: å‹ã«ã‚ˆã‚Šç•°ãªã‚‹ï¼ˆnat8=1, nat16=2, nat32=4, nat64=8ãƒã‚¤ãƒˆï¼‰
- **çµ±åˆãƒ†ã‚¹ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: dfxã‚³ãƒãƒ³ãƒ‰ã®çµ¶å¯¾ãƒ‘ã‚¹ä½¿ç”¨ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç®¡ç†ãŒé‡è¦
- **DIDãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°**: æ–°ã—ã„é–¢æ•°è¿½åŠ å¾Œã¯`dfx deploy`ã§å‹å®šç¾©ã®æ›´æ–°ç¢ºèªãŒå¿…è¦

### Recordå‹ã«ãŠã‘ã‚‹éå¯¾å¿œå‹åˆ¶é™ã®å®Ÿè£…å®Œäº†

#### å®Ÿè£…å®Œäº†é …ç›®
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**: `validateRecordFieldType`é–¢æ•°ã®å®Ÿè£…
- **åˆ¶é™å¯¾è±¡å‹**: func, service, reserved, query, oneway, composite_query
- **ã‚¨ãƒ©ãƒ¼æ¤œå‡º**: Recordä½œæˆæ™‚ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šæ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- **ãƒã‚¹ãƒˆã‚µãƒãƒ¼ãƒˆ**: Record/Variant/Arrayå†…ã®åˆ¶é™å‹ã‚‚æ¤œå‡º
- **ä»£æ›¿æ¡ˆæç¤º**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å®Ÿç”¨çš„ãªä»£æ›¿æ¡ˆã‚’ææ¡ˆ

#### ãƒ†ã‚¹ãƒˆå®Ÿè£…å®Œäº†
- **æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ**: è¨±å¯ã•ã‚ŒãŸå‹ã®ã¿ã‚’å«ã‚€Recordä½œæˆãƒ»æ“ä½œ
- **ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ**: åˆ¶é™ã•ã‚ŒãŸå‹ã‚’å«ã‚€Recordä½œæˆæ™‚ã®ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç¢ºèª  
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ**: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ç¢ºèª
- **ãƒã‚¹ãƒˆãƒ†ã‚¹ãƒˆ**: ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã§ã®åˆ¶é™ã•ã‚ŒãŸå‹æ¤œå‡ºç¢ºèª
- **ä»£æ›¿æ¡ˆãƒ†ã‚¹ãƒˆ**: Principal + Textçµ„ã¿åˆã‚ã›ã§ã®å®Ÿè£…ç¢ºèª

#### ä»£æ›¿å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```nim
# funcå‹ã®ä»£æ›¿ï¼ˆPrincipal + Textï¼‰
let funcRef = %*{
  "principal": Principal.fromText("aaaaa-aa"),
  "method": "handleSuccess"
}

# serviceå‹ã®ä»£æ›¿ï¼ˆPrincipalï¼‰
let serviceRef = %*{
  "ledger": Principal.fromText("ryjl3-tyaaa-aaaaa-aaaba-cai")
}
```

#### å®Ÿè£…è©³ç´°
- **é–¢æ•°**: `validateRecordFieldType` in `ic_record.nim`
- **å‘¼ã³å‡ºã—ç®‡æ‰€**: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šæ™‚ï¼ˆ`[]=`æ¼”ç®—å­ï¼‰
- **åˆ¶é™å‹•ä½œ**: åˆ¶é™ã•ã‚ŒãŸå‹ã‚’æ¤œå‡ºã™ã‚‹ã¨å³åº§ã«ValueErrorä¾‹å¤–ç™ºç”Ÿ
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: å‹åã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã€ä»£æ›¿æ¡ˆã‚’å«ã‚€è©³ç´°ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### æ—¢çŸ¥ã®åˆ¶ç´„äº‹é …ã¨èª²é¡Œ
- `newCandidValue`ã¯æ±ç”¨é–¢æ•°ã ãŒã€ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„å‹ã¯å€‹åˆ¥ã«è¿½åŠ ãŒå¿…è¦
- çµ±åˆãƒ†ã‚¹ãƒˆã¯é †æ¬¡å®Ÿè¡Œã®ãŸã‚ã€å¤§é‡ã®å‹è¿½åŠ æ™‚ã¯å®Ÿè¡Œæ™‚é–“ãŒé•·ããªã‚‹
- canisteré–¢æ•°åã¯`arg{TypeName}`ãƒ‘ã‚¿ãƒ¼ãƒ³ã«çµ±ä¸€ï¼ˆresponseãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ç‰¹æ®Šç”¨é€”ã®ã¿ï¼‰
- **nat64å‹ã®åˆ¶ç´„**: CandidValueã®natValãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒuintå‹ã®ãŸã‚ã€64bitå€¤ã®ä¸€éƒ¨ã§ã‚­ãƒ£ã‚¹ãƒˆã«ã‚ˆã‚‹æƒ…å ±æå¤±ãŒç™ºç”Ÿã™ã‚‹ã€‚å°ã•ãªå€¤ï¼ˆ42ã€100ãªã©ï¼‰ã¯æ­£å¸¸å‹•ä½œã™ã‚‹ãŒã€å¤§ããªå€¤ï¼ˆ10000000000ä»¥ä¸Šï¼‰ã§ã¯ä¸æ­£ç¢ºãªçµæœã¨ãªã‚‹å ´åˆãŒã‚ã‚‹ã€‚
- **int32å‹ã®é‡å¤§ãªå•é¡Œ**: å…¨ã¦ã®int32å€¤ã§Subtyping errorï¼ˆwire_type: int, expect_type: int32ï¼‰ãŒç™ºç”Ÿã€‚candidã®å‹å¤‰æ›å‡¦ç†ã«æ ¹æœ¬çš„ãªå•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ã€‚
- **int64å‹ã®å¤§ããªå€¤å•é¡Œ**: 1_000_000_000_000ä»¥ä¸Šã®å€¤ã§Canisterã‚¨ãƒ©ãƒ¼ï¼ˆIC0506ï¼‰ãŒç™ºç”Ÿã€‚canisterå†…éƒ¨ã§ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã¾ãŸã¯å‡¦ç†é™ç•Œã®å¯èƒ½æ€§ã€‚
- **funcå‹ã®æŠ€è¡“çš„åˆ¶ç´„ã¨å®Ÿç”¨å®Ÿè£…**: ç¾åœ¨ã®å®Ÿè£…ã§ã¯å˜ä½“ãƒ†ã‚¹ãƒˆã¯æˆåŠŸã™ã‚‹ãŒã€dfx callã§ã®canisterå‘¼ã³å‡ºã—ã¯å¤±æ•—ã™ã‚‹ã€‚Candidã®ä»•æ§˜ã§ã¯ã€funcå‹ã¯å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®å‹æƒ…å ±ã‚‚å«ã‚€Opaque referenceã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€ç¾åœ¨ã®å®Ÿè£…ã¯ç°¡ç•¥åŒ–ã•ã‚Œã¦ãŠã‚Šã€å®Œå…¨ãªCandidäº’æ›æ€§ãŒãªã„ã€‚ICPã®canisteré–“é€šä¿¡ã§ã®å®Ÿç”¨ã«ã¯è¿½åŠ å®Ÿè£…ãŒå¿…è¦ã€‚

### Funcå‹ã®å®Ÿç”¨çš„ãªå®Ÿè£…æ–¹é‡

#### ç¾åœ¨ã®å®Ÿè£…ãƒ¬ãƒ™ãƒ«
- âœ… **CandidValueæ§‹é€ **: funcå‹ã¯`CandidFunc`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å®Ÿè£…
- âœ… **å‹æƒ…å ±ã‚µãƒãƒ¼ãƒˆ**: å¼•æ•°ãƒ»æˆ»ã‚Šå€¤ã®å‹æƒ…å ±ã¨annotationï¼ˆquery, onewayï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆ
- âœ… **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°**: `newSimpleFunc`, `newQueryFunc`, `newUpdateFunc`ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç°¡å˜ã«ä½œæˆ
- âœ… **å˜ä½“ãƒ†ã‚¹ãƒˆ**: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ã®å¾€å¾©ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
- âŒ **dfx calläº’æ›æ€§**: ICPã®ç¾åœ¨ã®funcå‹å®Ÿè£…åˆ¶ç´„ã«ã‚ˆã‚Šå¤±æ•—

#### å®Ÿç”¨çš„ãªå›é¿ç­–ã¨ä»£æ›¿æ¡ˆ

##### 1. **Principalã¨ãƒ¡ã‚½ãƒƒãƒ‰åã®å€‹åˆ¥æ¸¡ã—**
```nim
# funcå‹ã®ä»£ã‚ã‚Šã«ã€principalã¨ãƒ¡ã‚½ãƒƒãƒ‰åã‚’åˆ¥ã€…ã®å¼•æ•°ã¨ã—ã¦æ¸¡ã™
service : {
  callOtherCanister: (target_principal: principal, method_name: text) -> (result: text);
}
```

##### 2. **Recordã‚’ä½¿ç”¨ã—ãŸæ§‹é€ åŒ–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
```nim
# funcæƒ…å ±ã‚’recordã¨ã—ã¦æ§‹é€ åŒ–
type FuncReference = record {
  principal: principal;
  method: text;
  args_types: vec text;    # å‹åã®æ–‡å­—åˆ—é…åˆ—
  return_types: vec text;
  annotations: vec text;   # "query", "oneway"ãªã©
}
```

##### 3. **ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ã®å‚ç…§**
```nim
# funcå‚ç…§ã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¾
service : {
  callFunction: (func_ref: text) -> (result: text);  # "aaaaa-aa.raw_rand"å½¢å¼
}
```

#### ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å®Ÿç”¨æ©Ÿèƒ½

##### CandidFuncæ§‹é€ ä½“
```nim
type CandidFunc = ref object
  principal: Principal      # å‘¼ã³å‡ºã—å…ˆcanister
  methodName: string       # ãƒ¡ã‚½ãƒƒãƒ‰å
  args: seq[CandidType]    # å¼•æ•°ã®å‹é…åˆ—
  returns: seq[CandidType] # æˆ»ã‚Šå€¤ã®å‹é…åˆ—
  annotations: seq[string] # query, oneway, composite_query
```

##### ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
```nim
# ã‚·ãƒ³ãƒ—ãƒ«ãªfuncï¼ˆå¼•æ•°ãƒ»æˆ»ã‚Šå€¤ãªã—ï¼‰
let func1 = newSimpleFunc(principal, "ping")

# Queryé–¢æ•°ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
let func2 = newQueryFunc(principal, "get_balance", @[ctNat])

# Updateé–¢æ•°ï¼ˆçŠ¶æ…‹å¤‰æ›´ã‚ã‚Šï¼‰
let func3 = newUpdateFunc(principal, "transfer", @[ctNat, ctPrincipal], @[ctBool])
```

#### ä½¿ç”¨ã«ãŠã‘ã‚‹åˆ¶ç´„ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

1. **å•ä½“ãƒ†ã‚¹ãƒˆç’°å¢ƒ**: å®Œå…¨ã«å‹•ä½œã€‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ãƒ»å‹å¤‰æ›ãƒ†ã‚¹ãƒˆãŒå¯èƒ½
2. **Canisteré–“é€šä¿¡**: ç¾åœ¨ã®ICPå®Ÿè£…åˆ¶ç´„ã«ã‚ˆã‚Šç›´æ¥ã®funcå‹æ¸¡ã—ã¯æœªå¯¾å¿œ
3. **æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³**: principalã¨ãƒ¡ã‚½ãƒƒãƒ‰åã‚’å€‹åˆ¥ã«æ¸¡ã™ã‹ã€recordã‚’ä½¿ç”¨
4. **å°†æ¥çš„å±•æœ›**: ICPã®funcå‹ã‚µãƒãƒ¼ãƒˆãŒæ‹¡å¼µã•ã‚ŒãŸå ´åˆã«å¯¾å¿œã§ãã‚‹æ§‹é€ ã‚’ç¶­æŒ

#### å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

- **ãƒ‡ãƒãƒƒã‚°ã¨é–‹ç™º**: å˜ä½“ãƒ†ã‚¹ãƒˆã§funcå‹ã®å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ã¯ååˆ†ã«æ¤œè¨¼å¯èƒ½
- **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³**: ä»£æ›¿æ¡ˆï¼ˆrecord, å€‹åˆ¥å¼•æ•°ï¼‰ã‚’ä½¿ç”¨ã—ã¦canisteré–“é€šä¿¡ã‚’å®Ÿè£…
- **Migration Ready**: å°†æ¥ã®ICPä»•æ§˜æ‹¡å¼µæ™‚ã«ã‚¹ãƒ ãƒ¼ã‚ºã«ç§»è¡Œã§ãã‚‹ã‚ˆã†è¨­è¨ˆ

## Blobå‹ã®ç‰¹åˆ¥ãªå®Ÿè£…æ–¹é‡

### ICPã§ã®Blobå‹è¡¨ç¾
- **é‡è¦**: ICPã®Candidãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã¯ã€`blob`å‹ã¯å®Ÿéš›ã«ã¯`vec nat8`ã¨ã—ã¦è¡¨ç¾ã•ã‚Œã‚‹
- **ãƒ‡ã‚³ãƒ¼ãƒ‰æ–¹é‡**: Candidãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã€`vec nat8`ã‚’æ¤œå‡ºã—ãŸå ´åˆã¯`candid types`ã®`ctBlob`ã¨ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹
- **ç›¸äº’å¤‰æ›æ€§**: `blob`ã¨`vec nat8`ã¯å®Œå…¨ã«ç›¸äº’å¤‰æ›å¯èƒ½
- **å‚è€ƒ**: https://internetcomputer.org/docs/references/candid-ref#type-blob

### Blobå‹ã®å®Ÿè£…è¦ä»¶

#### 1. candid_types.nimã®ä¿®æ­£
- `newCandidValue`é–¢æ•°ã§blobå‹ï¼ˆ`seq[uint8]`ã¾ãŸã¯ãƒã‚¤ãƒˆé…åˆ—ï¼‰ã®ã‚µãƒãƒ¼ãƒˆè¿½åŠ 
- `CandidValue`ã®`blobVal`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½¿ç”¨
- **å®Ÿè£…æ–¹é‡**: å†…éƒ¨çš„ã«ã¯é…åˆ—ã¨ã—ã¦æ‰±ã„ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ™‚ã¯`vec nat8`ã¨ã—ã¦å‡¦ç†
- blobå°‚ç”¨ã®é–¢æ•°åã‚’æä¾›ï¼ˆ`newCandidBlob`, `getCandidBlob`ç­‰ï¼‰ã—ã¤ã¤ã€å®Ÿæ…‹ã¯é…åˆ—æ“ä½œ

#### 2. ãƒ‡ã‚³ãƒ¼ãƒ‰å‡¦ç†ã®ç‰¹åˆ¥å¯¾å¿œ
- `vec nat8`ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã—ãŸå ´åˆã€`ctBlob`ã¨ã—ã¦åˆ†é¡
- `CandidValue(kind: ctBlob, blobVal: data)`ã‚’ç”Ÿæˆ
- ä»–ã®vectorå‹ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- **é‡è¦**: Candidãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã§ã¯å®Œå…¨ã«é…åˆ—ã¨ã—ã¦æ‰±ã‚ã‚Œã€blobç‰¹æœ‰ã®å‡¦ç†ã¯å­˜åœ¨ã—ãªã„

#### 3. ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¾ã®å¯¾å¿œ
- DIDãƒ•ã‚¡ã‚¤ãƒ«ã§ã®`blob`å‹ã®å®£è¨€: `argBlob : (blob) -> (blob);`
- dfx callã§ã®å¼•æ•°æŒ‡å®š: `blob "ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿"`
- UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ä½¿ç”¨: `blob "\CA\FF\FE"`
- ASCIIæ–‡å­—åˆ—: `blob "Hello World"`

#### 4. ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
- ç©ºã®blob: `blob ""`
- ASCIIæ–‡å­—åˆ—: `blob "Hello"`
- ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿: `blob "\00\01\02\03"`
- UTF-8æ–‡å­—åˆ—: `blob "ã“ã‚“ã«ã¡ã¯"`
- å¤§ããªãƒ‡ãƒ¼ã‚¿: 1KBä»¥ä¸Šã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿

#### 5. å˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè£…è©³ç´°ï¼ˆtest_nat.nimãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒï¼‰
```nim
suite "ic_blob tests":
  test "serializeCandid with small blob":
    let blobData = @[0x48u8, 0x65u8, 0x6Cu8, 0x6Cu8, 0x6Fu8] # "Hello"
    let blobValue = newCandidBlob(blobData)
    let encoded = encodeCandidMessage(@[blobValue])
    # DIDL0ãƒ˜ãƒƒãƒ€ãƒ¼(4ãƒã‚¤ãƒˆ) + å‹ãƒ†ãƒ¼ãƒ–ãƒ«(3ãƒã‚¤ãƒˆ) + LEB128é•·ã•(1ãƒã‚¤ãƒˆ) + ãƒ‡ãƒ¼ã‚¿(5ãƒã‚¤ãƒˆ) = 13ãƒã‚¤ãƒˆ
    check encoded.len == 13

  test "serializeCandid with empty blob":
    let blobValue = newCandidBlob(@[])
    let encoded = encodeCandidMessage(@[blobValue])
    # ç©ºã®blob: DIDL0ãƒ˜ãƒƒãƒ€ãƒ¼(4ãƒã‚¤ãƒˆ) + å‹ãƒ†ãƒ¼ãƒ–ãƒ«(3ãƒã‚¤ãƒˆ) + é•·ã•0(1ãƒã‚¤ãƒˆ) = 8ãƒã‚¤ãƒˆ
    check encoded.len == 8

  test "serializeCandid with binary data":
    let blobData = @[0x00u8, 0x01u8, 0x02u8, 0xFFu8]
    let blobValue = newCandidBlob(blobData)
    let encoded = encodeCandidMessage(@[blobValue])
    # ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã‚’æ¤œè¨¼
    check encoded.len > 8

  test "encode and decode with ASCII blob":
    let blobData = @[0x48u8, 0x65u8, 0x6Cu8, 0x6Cu8, 0x6Fu8] # "Hello"
    let blobValue = newCandidBlob(blobData)
    let encoded = encodeCandidMessage(@[blobValue])
    let decoded = decodeCandidMessage(encoded)
    check decoded.values[0].kind == ctBlob
    check decoded.values[0].blobVal == blobData

  test "encode and decode with empty blob":
    let blobValue = newCandidBlob(@[])
    let encoded = encodeCandidMessage(@[blobValue])
    let decoded = decodeCandidMessage(encoded)
    check decoded.values[0].kind == ctBlob
    check decoded.values[0].blobVal == @[]

  test "encode and decode with large blob":
    let blobData = newSeq[uint8](mdc:1000)
    for i in 0..<1000:
      blobData[i] = uint8(i mod 256)
    let blobValue = newCandidBlob(blobData)
    let encoded = encodeCandidMessage(@[blobValue])
    let decoded = decodeCandidMessage(encoded)
    check decoded.values[0].kind == ctBlob
    check decoded.values[0].blobVal == blobData

  test "multiple blob values":
    let blobValue1 = newCandidBlob(@[0x41u8, 0x42u8]) # "AB"
    let blobValue2 = newCandidBlob(@[0x43u8, 0x44u8]) # "CD"
    let blobValue3 = newCandidBlob(@[0x45u8, 0x46u8]) # "EF"
    let encoded = encodeCandidMessage(@[blobValue1, blobValue2, blobValue3])
    let decoded = decodeCandidMessage(encoded)
    check decoded.values.len == 3
    check decoded.values[0].kind == ctBlob
    check decoded.values[0].blobVal == @[0x41u8, 0x42u8]
    check decoded.values[1].kind == ctBlob
    check decoded.values[1].blobVal == @[0x43u8, 0x44u8]
    check decoded.values[2].kind == ctBlob
    check decoded.values[2].blobVal == @[0x45u8, 0x46u8]

  test "blob value type check":
    let blobData = @[0x54u8, 0x65u8, 0x73u8, 0x74u8] # "Test"
    let blobValue = newCandidBlob(blobData)
    check blobValue.kind == ctBlob
    check blobValue.blobVal == blobData
```

#### 6. canisteré–¢æ•°ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```nim
proc argBlob*(data: seq[uint8]): seq[uint8] {.ic_update.} =
  # blobãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾è¿”ã™
  return data

proc responseBlob*(): seq[uint8] {.ic_update.} =
  # ãƒ†ã‚¹ãƒˆç”¨ã®blobãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
  return @[0x48u8, 0x65u8, 0x6Cu8, 0x6Cu8, 0x6Fu8] # "Hello"
```

#### 7. dfx callãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œä¾‹
```bash
# ASCIIæ–‡å­—åˆ—ã®ãƒ†ã‚¹ãƒˆ
dfx canister call arg_msg_reply_backend argBlob 'blob "Hello"'

# ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆ  
dfx canister call arg_msg_reply_backend argBlob 'blob "\00\01\02\FF"'

# ç©ºã®blobã®ãƒ†ã‚¹ãƒˆ
dfx canister call arg_msg_reply_backend argBlob 'blob ""'

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹å°‚ç”¨ãƒ†ã‚¹ãƒˆ
dfx canister call arg_msg_reply_backend responseBlob
```

#### 8. æŠ€è¡“çš„æ³¨æ„ç‚¹
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: å¤§ããªblobãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†æ™‚ã¯ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã«æ³¨æ„
- **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: blobå‹ã¯å¯å¤‰é•·ã®ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚µã‚¤ã‚ºãŒå¤‰å‹•
- **å‹åˆ¤å®š**: `vec nat8`ã¨`blob`ã®è‡ªå‹•åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¯æ…é‡ã«å®Ÿè£…
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç„¡åŠ¹ãªãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã‚„ã‚µã‚¤ã‚ºåˆ¶é™ã®å‡¦ç†

#### 9. vec nat8ã¨ã®é–¢ä¿‚æ€§
- **å†…éƒ¨è¡¨ç¾**: ä¸¡æ–¹ã¨ã‚‚`seq[uint8]`ã¨ã—ã¦æ‰±ã†
- **å‹åŒºåˆ¥**: CandidValueã®kindãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§åŒºåˆ¥ï¼ˆ`ctBlob` vs `ctVec`ï¼‰
- **å¤‰æ›ãƒ«ãƒ¼ãƒ«**: 
  - æ˜ç¤ºçš„ã«`blob`ã¨æŒ‡å®šã•ã‚ŒãŸå ´åˆ â†’ `ctBlob`
  - `vec nat8`ã¨æŒ‡å®šã•ã‚ŒãŸå ´åˆ â†’ `ctVec`
  - ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã®è‡ªå‹•åˆ¤å®šã¯è¨­å®šå¯èƒ½

#### 10. çµ±åˆãƒ†ã‚¹ãƒˆã§ã®æ¤œè¨¼é …ç›®
- å„ç¨®ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®å¾€å¾©å¤‰æ›æˆåŠŸ
- dfx callã§ã®å¼•æ•°ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®æ­£ç¢ºæ€§
- ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®é©åˆ‡ãªå‡¦ç†
- å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã§ã®æ€§èƒ½ç¢ºèª
- `vec nat8`ã¨ã®ç›¸äº’å¤‰æ›ã®æ­£ç¢ºæ€§

### Blobå‹ã®å…·ä½“çš„ãªå®Ÿè£…æ–¹é‡

#### APIè¨­è¨ˆã®åŸºæœ¬åŸå‰‡
- **Candidãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«**: å®Œå…¨ã«`vec nat8`ã¨ã—ã¦å‡¦ç†ï¼ˆblobç‰¹æœ‰ã®å‡¦ç†ãªã—ï¼‰
- **Nim APIãƒ¬ãƒ™ãƒ«**: blobå°‚ç”¨é–¢æ•°åã§ä½¿ã„ã‚„ã™ã•ã‚’æä¾›
- **å†…éƒ¨å®Ÿè£…**: å®Ÿæ…‹ã¯é…åˆ—æ“ä½œã€blobå›ºæœ‰ã®å‡¦ç†ã¯é–¢æ•°åãƒ¬ãƒ™ãƒ«ã®ã¿

#### é–¢æ•°åã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
```nim
# CandidValueä½œæˆæ™‚
proc newCandidBlob*(data: seq[uint8]): CandidValue =
  # å†…éƒ¨çš„ã«ã¯vecã¨åŒã˜å‡¦ç†ã ãŒã€kindã‚’ctBlobã«è¨­å®š
  CandidValue(kind: ctBlob, blobVal: data)

# å€¤å–å¾—æ™‚
proc getBlobValue*(cv: CandidValue): seq[uint8] =
  # å†…éƒ¨çš„ã«ã¯é…åˆ—ã¨ã—ã¦å–å¾—
  cv.blobVal

# Request/Replyã§ã®å–ã‚Šæ‰±ã„
proc getBlob*(self: Request, index: int): seq[uint8]
proc reply*(data: seq[uint8])  # blobå°‚ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
```

#### å®Ÿè£…ã§ã®æ³¨æ„ç‚¹
- **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰**: `vec nat8`ã¨å®Œå…¨ã«åŒä¸€ã®å‡¦ç†
- **å‹åˆ¤å®š**: CandidValueã®kindãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®ã¿åŒºåˆ¥
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: é…åˆ—æ“ä½œã¨åŒä¸€ã®ãŸã‚ã€è¿½åŠ ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªã—
- **äº’æ›æ€§**: `vec nat8`ã¨ã®å®Œå…¨ãªç›¸äº’å¤‰æ›ãŒå¯èƒ½

#### ã‚³ãƒ¼ãƒ‰ä¾‹ã§ã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸
```nim
# ä½¿ç”¨ä¾‹ï¼šblobä½œæˆ
let blobData = @[0x48u8, 0x65u8, 0x6Cu8, 0x6Cu8, 0x6Fu8]
let candidBlob = newCandidBlob(blobData)  # kindãŒctBlobã«ãªã‚‹

# ä½¿ç”¨ä¾‹ï¼šå€¤å–å¾—
let retrievedData = getBlobValue(candidBlob)  # seq[uint8]ã¨ã—ã¦å–å¾—

# å†…éƒ¨å‡¦ç†ï¼šã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ™‚ã¯vec nat8ã¨åŒã˜
let encoded = serializeCandid(candidBlob)  # vec nat8ã¨ã—ã¦å‡¦ç†
```

#### vec nat8ã¨ã®é–¢ä¿‚æ€§
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«**: åŒºåˆ¥ä¸å¯èƒ½ï¼ˆåŒä¸€ã®ãƒã‚¤ãƒˆåˆ—ï¼‰
- **å‹æƒ…å ±ãƒ¬ãƒ™ãƒ«**: CandidValue.kindã§åŒºåˆ¥
- **é–¢æ•°ãƒ¬ãƒ™ãƒ«**: ç•°ãªã‚‹é–¢æ•°åã§åˆ©ä¾¿æ€§å‘ä¸Š
- **å®Ÿè¡Œæ™‚å‡¦ç†**: å®Œå…¨ã«åŒä¸€

#### å®Ÿè£…æ™‚ã®ä½œæ¥­é …ç›®
1. **candid_types.nim**: `newCandidBlob`é–¢æ•°è¿½åŠ 
2. **request.nim**: `getBlob`é–¢æ•°è¿½åŠ 
3. **reply.nim**: blobç”¨ã®`reply`ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰è¿½åŠ 
4. **serialization**: vec nat8ã¨åŒä¸€ã®å‡¦ç†ã‚’æµç”¨
5. **deserialization**: å‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã®ã¿è¿½åŠ 

## ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ã¨Next Steps

### å®Ÿè£…å®Œäº†æ¸ˆã¿
- **åŸºæœ¬å‹ï¼ˆPrimitive Typesï¼‰**: null, bool, nat, int, nat8, nat16, nat32, nat64, int8, int16, float32, float64, text, principal
- **è¤‡åˆå‹ï¼ˆComposite Typesï¼‰**: blob, opt, vec, recordï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆãƒ»canisteré–¢æ•°ï¼‰, variantï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆãƒ»canisteré–¢æ•°ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆï¼‰
- **çµ±åˆãƒ†ã‚¹ãƒˆåŸºç›¤**: è‡ªå‹•dfx deployæ©Ÿèƒ½ã¨canister callå®Ÿè¡Œãƒ†ã‚¹ãƒˆç’°å¢ƒ

### é€²è¡Œä¸­ã®èª²é¡Œ
- **Int32å‹ã®ä¿®æ­£**: Subtyping errorã®æ ¹æœ¬åŸå› è§£æ˜ã¨ä¿®æ­£ãŒå¿…è¦
- **Recordå‹ã®dfx callãƒ†ã‚¹ãƒˆ**: canisteré–¢æ•°ã¯å®Ÿè£…æ¸ˆã¿ã€çµ±åˆãƒ†ã‚¹ãƒˆã¸ã®è¿½åŠ ãŒå¿…è¦
- **Management Canisteré€£æº**: EcdsaPublicKeyArgsæ§‹é€ ä½“ã®å®Ÿè£…ã¨å®Ÿéš›ã®Management Canisterå‘¼ã³å‡ºã—

### æ¬¡ã®å®Ÿè£…å„ªå…ˆåº¦
1. **Recordå‹ã®dfx callãƒ†ã‚¹ãƒˆå®Œäº†** - responseRecordé–¢æ•°ã®çµ±åˆãƒ†ã‚¹ãƒˆã¸ã®è¿½åŠ ã¨å®Ÿè¡Œ
2. **Int32å‹ã®å•é¡Œè§£æ±º** - å‹å¤‰æ›å‡¦ç†ã®ä¿®æ­£
3. **EcdsaPublicKeyArgså®Ÿè£…** - Management Canisterç”¨ã®è¤‡åˆå‹æ§‹é€ ä½“
4. **ç‰¹æ®Šå‹ã®å®Ÿè£…** - func, service, reserved, emptyå‹

### Management Canisteré€£æºã«ã¤ã„ã¦
ã“ã®ãƒ–ãƒ©ãƒ³ãƒã§è¡Œã†ã¹ãã‚¿ã‚¹ã‚¯ã¯ã€ICPã®Management canisterã®public keyé–¢æ•°ã‚’å‘¼ã¶ãŸã‚ã«å¿…è¦ãªå¼•æ•°ã‚’ã€candidã®ä»•æ§˜ã«åŸºã¥ã„ã¦æ­£ã—ãcandid messageã«å¤‰æ›ã§ãã‚‹ã“ã¨ã§ã™ã€‚

public keyé–¢æ•°ã®å¼•æ•°ã®ä»•æ§˜ã¯ã€Motokoã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
type ecdsa_public_key_args = record {
    canister_id : opt canister_id;
    derivation_path : vec blob;
    key_id : record { curve : ecdsa_curve; name : text };
};
```
https://internetcomputer.org/docs/building-apps/network-features/signatures/t-ecdsa#obtaining-public-keys

ecdsa_curveã¯variantå‹ã§ã‚ã‚Šã€`secp256k1`ã¨`secp256r1`ã®ã©ã¡ã‚‰ã‹ã®å€¤ã‚’æŒã¡ã¾ã™ã€‚

didãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡æ³•ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://internetcomputer.org/docs/building-apps/interact-with-canisters/candid/using-candid/

didãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã—ãŸå¾Œã¯ã€`dfx deploy`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå¾Œã§canisterã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å‹å®šç¾©ã‚’å¤‰æ›´ã—ã¦ã„ã„ã‹å¯¾è©±å‹ã§èã‹ã‚Œã‚‹ã®ã§ã€yesã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸã™ã‚‹ã‹ã©ã†ã‹ãƒ†ã‚¹ãƒˆã™ã‚‹æ™‚ã¯ã€`/application/examples/arg_msg_reply` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã€ `dfx deploy` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã„ã€ `dfx canister call arg_msg_reply_backend responseTEcdsaPublicKeyArgs` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦canister callã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

